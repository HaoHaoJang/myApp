<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <meta content="yes" name="apple-mobile-web-app-capable" />
    <title>发表评论</title>
    <link rel="stylesheet" href="../../css/weui.css" />
    <link rel="stylesheet" href="../../css/jquery-weui.css" />
    <link rel="stylesheet" href="../../css/base.css" />
    <link rel="stylesheet" href="../../asset/font/iconfont.css" />
    <script src="../../asset/font/iconfont.js"></script>
    <style>
      .comment .content input {
        height: 3rem;
        line-height: 3rem;
      }

      .comment .content {
        margin-bottom: 1rem;
      }

      .comment .content .title-content {
        padding: 0.2rem;
        font-size: 1.2rem;
      }

      .flx-w-button {
        height: 3.5rem;
        line-height: 3.5rem;
      }

      .comment .content .title-content h4 {
        font-size: 1.4rem;
        font-weight: 500;
        padding: 1rem 0;
      }

      .comment .content p {
        font-size: 1.2rem;
        line-height: 1.6rem;
      }

      .comment .content .title-content span {
        color: #cccccc;
      }

      .comment .content .area {
        height: 4rem;
        line-height: 4rem;
        background: #ffffff;
        border-bottom: 1px solid #dddddd;
        border-top: 1px solid #dddddd;
        font-size: 1.4rem;
        padding-left: 0.5rem;
      }

      .comment .content input,
      .comment .content textarea {
        width: 100%;
        padding-left: 6px;
        font-size: 1.4rem;
      }

      .comment .content textarea {
        padding-top: 0.5rem;
      }

      .flx-w {
        width: 4rem;
      }

      .share-content {
        height: 40px;
        line-height: 40px;
      }

      .share-content .share {
        padding: 0.6rem 0.8rem;
        font-size: 1.4rem;
        background: #ff6600;
        border-radius: 2px;
        color: #ffffff;
      }

      .page-next {
        border-top: 1px solid #ddd;
        padding: 1rem 0;
      }

      .page-next div {
        margin: 0.5rem 0;
      }

      .share-content {
        height: 40px;
        line-height: 40px;
        font-size: 1.2rem;
      }

      .comment-footer .iconfont {
        font-size: 1.6rem !important;
      }

      .comment-footer .num {
        margin-left: 0.5rem;
      }

      .comment-footer .publishTit {
        padding-bottom: 2rem;
      }

      .publish .flx-w {
        height: 3rem;
        width: 3rem;
      }

      .comment-input {
        padding-left: 6px;
        width: 100%;
        height: 35px;
        line-height: 35px;
        background: #ececec;
      }

      .comment .btn {
        height: 3.5rem;
        width: 100%;
        line-height: 3.5rem;
        color: #ffffff;
        border: none;
        background: #4777f3;
        border-radius: 4px;
      }

      .comment .header-im {
        border-radius: 100%;
        height: 4rem;
        width: 4rem;
      }

      .comment-comment-user {
        margin-top: 3rem;
      }

      .comment-comment-user .comment-user-name,
      .comment-comment-user .comment-user-time {
        height: 2rem;
        line-height: 2rem;
        font-size: 1.2rem;
        margin-left: 1rem;
      }

      .comment-comment-user .comment-user-time {
        color: #dddddd;
      }

      .comment-comment-user .comment-user-content {
        margin-left: 1rem;
        line-height: 2rem;
        font-size: 1.2rem;
        margin-top: 1rem;
      }
      .icon-dianzan2 {
        color: #4777f3 !important;
      }
      .weui-toast--text,
      .weui-toast_content {
        font-size: 1.2rem !important;
      }
    </style>
  </head>

  <body>
    <div class="comment">
      <header>
        <div class="header">
          <div class="back">
            <i class="icon iconfont icon-arrow-lift"></i>
          </div>
          <div class="head-tit">资讯详情</div>
          <div class="back"></div>
        </div>
      </header>
      <div class="content pad-mix bg-c-w">
        <div class="container">
          <script id="newsDetailTpl" type="text/html">

            <div class="title-content">
              <h4>{{list.docSubject}}</h4>
              <span>{{list.docCreateTime}}发布 </span>
            </div>
            <div class="tex-r share-content">
              <!-- <span class="share">
                <i class="icon iconfont icon-arrow-lift"></i>
                分享
              </span> -->
            </div>
            <div>
              <p>
               {{@ list.docContent}}
              </p>
            </div>
          </script>
        </div>
        <!-- <div class="page-next">
          <div>上一篇：<span>重庆盘古互联网+是的发送发大水</span></div>
          <div>下一篇：<span>重庆盘古互联网+是的发送发大水</span></div>
        </div> -->
      </div>
      <div class="comment-footer pad-mix bg-c-w">
        <div class="flx fot-m publishTit">
          <div class="flx-1 tex-l">评论 (<span id="num1">2</span>)</div>
          <div class="flx-1 tex-r" id="greate">
            <i class="icon iconfont icon-dianzan1"></i>点赞(
            <span class="num" id="num2">6</span>)
          </div>
        </div>
        <div>
          <div class="flx publish">
            <div class="flx-w">
              <img
                src=""
                data-src="http://cdn.jirengu.com/book.jirengu.com/img/1.jpg"
              />
            </div>
            <div class="flx-1 mar-r-l">
              <input
                type="text"
                class="comment-input"
                placeholder="来说说你的想法吧"
                id="docContent"
              />
            </div>
            <div class="flx-w-button">
              <button class="btn" onclick="publish()">发布</button>
            </div>
          </div>
          <div class="flx comment-comment-user"></div>
        </div>
      </div>
    </div>
  </body>
  <!-- 模板 -->
  <script id="newCommentList" type="text/html">
    {{each list as item}}
    <div class="flx-w">
        <img src="" class="header-im" data-src="{{domain + item.fanPhoto}}" />
        <div></div>
    </div>
    <div class="flx-1">
        <div class="comment-user-name">{{item.fanNick}}</div>
        <div class="comment-user-time">{{item.docCreateTime}}发布</div>
        <div class="comment-user-content">
          {{item.talkContent }}
        </div>
    </div>
    {{/each}}
  </script>
  <script src="../../js/lib.js"></script>
  <script src="../../js/lazyLoad.js"></script>
  <script src="../../js/common.js"></script>
  <script>
    var fdId = "";
    $(function () {
      getDetail();
      newsCommentList();
    });
    // 查询详情接口
    function getDetail() {
      var result = ajaxMothed("/resource/wechatDoc/getDocDetail", {
        fdId: GetRequest(window.location.href)["fdId"],
      });
      result.done(function (resp) {
        fdId = resp.data.fdId;
        render(".container", "newsDetailTpl", resp.data, true);
        // 渲染评论列表
        newsCommentList(resp.data.talkList);
        // 评论数量
        $("#num1").html(resp.data.talkNum);
        // 点赞数量
        $("#num2").html(resp.data.thumupNum);
      });
    }
    // 点赞
    $("#greate").click(function () {
      if ($(".greate .icon").hasClass("icon-dianzan2")) {
        return false;
      }
      onfocue();
    });
    // 点赞接口
    function onfocue() {
      var result = ajaxMothed("/resource/wechatDoc/auth/thumUpDoc", {
        fdId: fdId,
      });
      result
        .done(function (resp) {
          if (resp.success) {
            $(".greate .icon").addClass("icon-dianzan2");
            getDetail();
          }
        })
        .fail(function (resp) {
          $.toast(resp.msg, "text");
        });
    }
    // 获取评论列表
    function newsCommentList(talkList) {
      render(".comment-comment-user", "newCommentList", talkList, true);
    }
    // 发布评论
    function publish() {
      if (!$("#docContent").val()) {
        return false;
      }
      var result = ajaxMothed("/resource/wechatDoc/auth/talkDoc", {
        fdId: fdId,
        docContent: $("#docContent").val(),
      });
      result
        .done(function (resp) {
          if (resp.success) {
            $.toast("评论成功", "text");
            getDetail();
          } else {
            $.toast(resp.msg, "text");
          }
        })
        .fail(function (resp) {
          $.toast(resp.msg, "text");
        });
    }
  </script>
</html>
