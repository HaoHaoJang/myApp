<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"
    />
    <meta content="yes" name="apple-mobile-web-app-capable" />
    <title></title>
    <link rel="stylesheet" href="../../css/weui.css" />
    <link rel="stylesheet" href="../../css/jquery-weui.css" />
    <link rel="stylesheet" href="../../css/base.css" />
    <link rel="stylesheet" href="../../asset/font/iconfont.css" />
    <link rel="stylesheet" href="predeter.css" />
    <script src="../../asset/font/iconfont.js"></script>
  </head>

  <body>
    <div class="perdetermine">
      <!--<div class="flx line-content fot-m bg-c-w">-->
        <!--<div class="tex-l flx-1">大沙龙空间</div>-->
        <!--&lt;!&ndash;<div class="tex-r flx-1 clor-active">500元/半小时</div>&ndash;&gt;-->
      <!--</div>-->
      <!--<div class="flx line-content fot-s">-->
        <!--<div class="tex-l flx-1 clor-gre">预定时间</div>-->
        <!--<div class="tex-r flx-1 clor-active clor-blu">2020-07-17</div>-->
      <!--</div>-->
      <!--<div class="bg-c-w">-->
        <!--<div class="fot-s pre-timmer">-->
          <!--<div class="flx pre-timmer-container">-->
            <!--<div class="flx-w">上午</div>-->
            <!--<div class="flx-1">-->
              <!--<span class="timer-content">08:00</span>-->
              <!--<span class="timer-content">08:00</span>-->
              <!--<span class="timer-content">08:00</span>-->
              <!--<span class="timer-content">08:00</span>-->
              <!--<span class="timer-content">08:00</span>-->
              <!--<span class="timer-content">08:00</span>-->
              <!--<span class="timer-content">08:00</span>-->
              <!--<span class="timer-content">08:00</span>-->
              <!--<span class="timer-content">08:00</span>-->
              <!--<span class="timer-content">08:00</span>-->
            <!--</div>-->
          <!--</div>-->
          <!--<div class="flx pre-timmer-container">-->
            <!--<div class="flx-w">下午</div>-->
            <!--<div class="flx-1">-->
              <!--<span class="timer-content">08:00</span>-->
              <!--<span class="timer-content">08:00</span>-->
              <!--<span class="timer-content">08:00</span>-->
              <!--<span class="timer-content">08:00</span>-->
              <!--<span class="timer-content">08:00</span>-->
              <!--<span class="timer-content">08:00</span>-->
              <!--<span class="timer-content">08:00</span>-->
              <!--<span class="timer-content">08:00</span>-->
              <!--<span class="timer-content">08:00</span>-->
              <!--<span class="timer-content">08:00</span>-->
            <!--</div>-->
          <!--</div>-->
        <!--</div>-->
        <!--<div class="flx line-content fot-s">-->
          <!--<div class="tex-l flx-1 fot-mi-s titp">-->
            <!--提示：<span class="btn-span">已选</span>-->
            <!--<span class="btn-span">已预定</span>-->
            <!--<span class="btn-span">可预定</span>-->
          <!--</div>-->
          <!--<div class="tex-r fl-tex-w">-->
            <!--共 <span class="clor-active">0</span>小时-->
            <!--&lt;!&ndash;合计<span&ndash;&gt;-->
              <!--&lt;!&ndash;class="clor-active"&ndash;&gt;-->
              <!--&lt;!&ndash;&gt;0</span&ndash;&gt;-->
            <!--&lt;!&ndash;&gt;元&ndash;&gt;-->
          <!--</div>-->
        <!--</div>-->
      <!--</div>-->
      <!--<div class="line-content fot-s">-->
        <!--<div class="tex-l clor-gre">会议室设备预约</div>-->
      <!--</div>-->
      <!--<div class="line-content fot-s bor-t">-->
        <!--<div class="tex-l clor-gre">服务内容预约</div>-->
      <!--</div>-->
      <!--<div class="flx line-content fot-s bor-t bg-c-w">-->
        <!--<div class="tex-l flx-1">茶水</div>-->
        <!--<div class="tex-l flx-1">5元/位</div>-->
        <!--<div class="tex-r flx-1 clor-active"><i></i><span>1</span><i></i></div>-->
      <!--</div>-->
      <!--<div class="flx line-content fot-s bor-t bg-c-w">-->
        <!--<div class="tex-l flx-1">茶水</div>-->
        <!--<div class="tex-l flx-1">5元/位</div>-->
        <!--<div class="tex-r flx-1 clor-active"><i></i><span>1</span><i></i></div>-->
      <!--</div>-->
      <!--<div class="flx line-content fot-s bor-t bg-c-w">-->
        <!--<div class="tex-l flx-1">茶水</div>-->
        <!--<div class="tex-l flx-1">5元/位</div>-->
        <!--<div class="tex-r flx-1 clor-active"><i></i><span>1</span><i></i></div>-->
      <!--</div>-->
      <!--<div class="line-content fot-s">-->
        <!--<div class="tex-l clor-gre">其他要求</div>-->
      <!--</div>-->
      <!--<div class="flx line-content bor-t fot-m bg-c-w">-->
        <!--<div class="tex-l fl-tex-w">是否开发票</div>-->
        <!--<div class="flx-1"></div>-->
      <!--</div>-->
      <!--<div class="flx line-content bor-t fot-m bg-c-w">-->
        <!--<div class="tex-l fl-tex-t-w">发票类型</div>-->
        <!--<div class="flx-1">增值税专用发票</div>-->
      <!--</div>-->
      <!--<div class="flx line-content bor-t fot-m bg-c-w">-->
        <!--<div class="tex-l fl-tex-t-w">发票抬头</div>-->
        <!--<div class="tex-l flx-1"></div>-->
      <!--</div>-->
      <!--<div class="flx line-content bor-t fot-m bg-c-w">-->
        <!--<div class="tex-l fl-tex-t-w">纳税识别号</div>-->
        <!--<div class="flx-1"></div>-->
      <!--</div>-->
      <!--<div class="line-content fot-s">-->
        <!--<div class="tex-l clor-gre">预定人信息</div>-->
      <!--</div>-->
      <!--<div class="flx line-content bor-t fot-m bg-c-w">-->
        <!--<div class="tex-l fl-tex-t-w">姓名</div>-->
        <!--<div class="flx-1"></div>-->
      <!--</div>-->
      <!--<div class="flx line-content bor-t fot-m bg-c-w">-->
        <!--<div class="tex-l fl-tex-t-w">手机号码</div>-->
        <!--<div class="flx-1">增值税专用发票</div>-->
      <!--</div>-->
      <!--<div class="flx line-content bor-t fot-m bg-c-w">-->
        <!--<div class="tex-l fl-tex-t-w">邮箱</div>-->
        <!--<div class="flx-1"></div>-->
      <!--</div>-->
      <!--<div class="flx line-content bor-t fot-m bg-c-w">-->
        <!--<div class="tex-l fl-tex-t-w">公司名称</div>-->
        <!--<div class="flx-1"></div>-->
      <!--</div>-->
    </div>
  </body>
  <script src="../../js/lib.js"></script>
  <script src="../../js/common.js"></script>
  <script src="../../js/lazyLoad.js"></script>
  <script id="perdetermineid" type="text/html">
    <div class="flx line-content fot-m bg-c-w">
      <div class="tex-l flx-1">{{list.name}}</div>
    </div>
    <div class="flx line-content fot-s">
      <div class="tex-l flx-1 clor-gre">预定时间</div>
      <div class="tex-r flx-1 clor-active clor-blu">{{list.date}}</div>
      </div>
      <div class="bg-c-w">
      <div class="fot-s pre-timmer">
      <div class="flx pre-timmer-container">
      <div class="flx-w">上午</div>
      <div class="flx-1">
        {{each list.dateFirst as item}}
        <span class="timer-content">{{item.time}}</span>
        {{/each}}
    </div>
    </div>
    <div class="flx pre-timmer-container">
      <div class="flx-w">下午</div>
      <div class="flx-1">
        {{each list.dateSend as item}}
        <span class="timer-content">{{item.time}}</span>
        {{/each}}
      </div>
    </div>
    </div>
    <div class="flx line-content fot-s">
            <div class="tex-l flx-1 fot-mi-s titp">
            提示：<span class="btn-span">已选</span>
            <span class="btn-span">已预定</span>
            <span class="btn-span">可预定</span>
            </div>
            <div class="tex-r fl-tex-w">
            共 <span class="clor-active" id="selectAllTime">0</span>小时
            <!--合计<span-->
            <!--class="clor-active"-->
            <!--&gt;0</span-->
            <!--&gt;元-->
            </div>
            </div>
            </div>
    <div class="line-content">
      <div class="btn-sure" id="sureMeet">确认</div>
    </div>
  </script>
  <script>
    // dateFirst 上午可预定时间 dateSend 下午可以预定时间
    var dateFirst = [{time: '8:00', isSelect: '', isPre: ''}, {time: '8:30', isSelect: '', isPre: ''},{time: '9:00', isSelect: '', isPre: ''}, {time: '9:30', isSelect: '', isPre: ''}, {time: '10:00', isSelect: '', isPre: ''}, {time: '10:30', isSelect: '', isPre: ''}, {time: '11:00', isSelect: '', isPre: ''}, {time: '11:30', isSelect: '', isPre: ''}, {time: '12:00', isSelect: '', isPre: ''}, {time: '12:30', isSelect: '', isPre: ''}],
        dateSend = [{time: '14:00', isSelect: '', isPre: ''}, {time: '14:30', isSelect: '', isPre: ''},{time: '15:00', isSelect: '', isPre: ''}, {time: '15:30', isSelect: '', isPre: ''}, {time: '16:00', isSelect: '', isPre: ''}, {time: '16:30', isSelect: '', isPre: ''}, {time: '17:00', isSelect: '', isPre: ''}, {time: '17:30', isSelect: '', isPre: ''},{time: '18:00', isSelect: '', isPre: ''},
          {time: '18:30', isSelect: '', isPre: ''}, {time: '19:00', isSelect: '', isPre: ''}, {time: '19:30', isSelect: '', isPre: ''}, {time: '20:00', isSelect: '', isPre: ''}, {time: '20:30', isSelect: '', isPre: ''}, {time: '21:00', isSelect: '', isPre: ''}, {time: '21:30', isSelect: '', isPre: ''}, {time: '22:00', isSelect: '', isPre: ''}, {time: '22:30', isSelect: '', isPre: ''}];
    // 查询详情接口
    function getDetail() {
      var result = ajaxMothed("/resource/wechatArea/auth/getMeetOrders", {
        fdId: GetRequest(window.location.href)["fdId"],
        orderDate: GetRequest(window.location.href)["date"],
      });
      result.done(function (resp) {
        resp.data.dateFirst = dateFirst
        resp.data.dateSend = dateSend
        resp.data.name = GetRequest(window.location.href)["name"]
        resp.data.date = GetRequest(window.location.href)["date"]
        render(".perdetermine", "perdetermineid", resp.data, true);
        // 选择时间
        $('.timer-content').click(function () {
          if ($(this).hasClass('select-style')) {
            // 判断是否是已经被选中是则去除选中效果
            if ($('.select-style').length > 0) {
              for(var i=0;i<$('.timer-content').length;i++) {
                $($('.timer-content')[i]).removeClass('select-style')
                $($('.timer-content')[i]).removeClass('select-sty')
                $('#selectAllTime').html(0) // 总是长还原
              }
            }
          } else { // 否则加上选中效果
            $(this).addClass('select-sty')
            // 判断是否已经有被选中的了
            if ($('.select-style').length > 0) {
              var param = [], key = 0;
              for(var j=0;j<$('.timer-content').length;j++) {
                if ($($('.timer-content')[j]).hasClass('select-style')) {
                  $($('.timer-content')[j]).removeClass('select-sty')
                  param.push(j) // 将所有的已经被选中的下标存入param里
                }
                if ($($('.timer-content')[j]).hasClass('select-sty')) {
                  key = j // 获取刚刚选中的下标
                }
              }
              // 选中的下标如果大于已经选中的最大值则将之间的所有值都选上
              if (key > param[0]) {
                for(var n=param[0];n<key+1;n++) {
                  $($('.timer-content')[n]).addClass('select-style')
                }
              } else {
                // 选中的下标如果小于已经选中的最大值则将之间的所有值都选上
                for(var m=key;m<param[0]+1;m++) {
                  $($('.timer-content')[m]).addClass('select-style')
                }
              }

            } else {
              $(this).addClass('select-style')
            }
          }
          if($('.select-style').length > 0) {
            // 计算总共选中的时长 firstDate1 开始时间的时 firstDate2开始时间的分 lastDate1 结束时间的时 lastDate2结束时间的分
            var firstDate1 = ($($('.select-style')[0]).html()).split(':')[0], firstDate2 = ($($('.select-style')[0]).html()).split(':')[1]
            var lastDate1 = ($($('.select-style')[$('.select-style').length-1]).html()).split(':')[0], lastDate2 = ($($('.select-style')[$('.select-style').length-1]).html()).split(':')[1]
            var hour = lastDate1 - firstDate1 // 计算时的差
            var minute = lastDate2 - firstDate2 // 计算分的差
            if (minute < 0) { // 当分小于0时说明firstDate2是30分钟 lastDate2是0分钟 则小时要减一
              hour = hour - 1
              minute = minute * (-1) // 分差取反
            }
            $('#selectAllTime').html(hour + ':' + minute) // 拼接赋值
          }
        })
        // 确定预约
        $('#sureMeet').click(function () {
          postMeeting()
        })
      });
    }
    // 预约接口
    var userName = '', campanyName = '';
    function postMeeting() {
      var result = ajaxMothed("/resource/wechatArea/auth/getMeetOrders", {
        fdId: GetRequest(window.location.href)["fdId"],
        fddate: GetRequest(window.location.href)["date"],
        fdcontact: userName || '',
        fdcompany: campanyName || '',
        fdStartTime: $($('.select-style')[0]).html(),
        fdEndTime:$($('.select-style')[$('.select-style').length-1]).html()
      }, 'POST');
      result.done(function (resp) {
        $.toast("恭喜预定成功", function() {
          window.history.back(-1);
        })
      })
    }
    getDetail();
  </script>
</html>
